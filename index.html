<!--
3D Shopify Store — G-Class Entrance (Single-file, production-ready starter) — DEBUGGED
Filename: 3d-shopify-gclass.html

Changelog for this rewrite (fixes applied):
- Fixed SyntaxError caused by unescaped literal newlines inside single-quoted JS strings in the checkout summary (replaced with safe 
 sequences).
- Replaced dynamic insertion of a <model-viewer> tag via innerHTML with a safe DOM-based creation (document.createElement) so the custom element upgrades reliably.
- Added defensive checks before using DOM elements and removed any stray invalid tokens.
- Kept the rest of the UI and entrance animation intact.

Usage:
1. Save this file and open in a modern browser.
2. Replace placeholder images and model URLs with your own assets (Shopify CDN or hosted GLB files).
3. For production, integrate checkout with Shopify Storefront API or redirect to a Shopify checkout URL.

-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>G-Class 3D Entrance — Local Brand Store</title>

  <!-- Performance hints -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- model-viewer for product 3D preview (deferred) -->
  <script type="module" defer src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <!-- Three.js + GLTFLoader for the entrance animation (deferred) -->
  <script defer src="https://cdn.jsdelivr.net/npm/three@0.156.0/build/three.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/three@0.156.0/examples/js/loaders/GLTFLoader.js"></script>

  <style>
    :root{--accent:#0ea5a4;--bg:#fbfcfd;--card:#ffffff;--muted:#6b7280;--glass:rgba(255,255,255,0.7)}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{font-family:Inter,system-ui,Arial,Helvetica,sans-serif;margin:0;background:linear-gradient(180deg,#f8fafc, #ffffff);color:#111}
    .center{display:flex;align-items:center;justify-content:center}

    /* Fullscreen 3D overlay */
    #entrance{position:fixed;inset:0;background:#070809;color:white;z-index:9999;display:flex;flex-direction:column}
    #three-canvas{flex:1}
    .enter-ui{position:absolute;right:32px;bottom:32px;background:var(--glass);backdrop-filter:blur(6px);padding:18px;border-radius:12px;color:#0b1020}
    .enter-title{font-weight:700;font-size:20px;margin-bottom:8px}
    .enter-desc{color:var(--muted);font-size:13px;margin-bottom:12px}
    .enter-btn{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}

    /* Main site layout */
    .site{max-width:1200px;margin:28px auto;padding:0 20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .logo{font-weight:800;letter-spacing:0.6px;font-size:20px}
    nav{display:flex;gap:12px;align-items:center}
    .search{border:1px solid #e6e7eb;padding:8px;border-radius:10px}
    .cart-btn{background:var(--card);border:1px solid #e6e7eb;padding:8px 12px;border-radius:8px;cursor:pointer}

    .hero{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-bottom:20px}
    .hero-card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(16,24,40,0.06)}
    .hero h1{margin:0 0 10px 0}
    .hero p{color:var(--muted);margin-top:6px}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px}
    .product{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 20px rgba(16,24,40,0.04);display:flex;flex-direction:column}
    .product img{width:100%;height:260px;object-fit:cover;border-radius:8px}
    .title{font-weight:700;margin-top:10px}
    .meta{color:var(--muted);font-size:13px}
    .price{color:var(--accent);font-weight:700;margin-top:8px}
    .buy-btn{margin-top:12px;background:linear-gradient(90deg,#0ea5a4,#06b6d4);border:none;color:white;padding:10px;border-radius:10px;cursor:pointer}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;padding:16px;z-index:2000}
    .modal{background:var(--card);max-width:980px;width:100%;border-radius:12px;padding:18px;display:grid;grid-template-columns:1fr 360px;gap:20px}
    .viewer-wrap{border-radius:10px;overflow:hidden;background:#111}
    model-viewer{width:100%;height:560px;background:transparent}
    .info{padding:8px}
    .size-select{display:flex;gap:8px;margin-top:10px}
    .size-select button{padding:8px 10px;border-radius:8px;border:1px solid #e6e7eb;background:white;cursor:pointer}

    footer{margin-top:36px;text-align:center;color:var(--muted);font-size:13px}

    @media (max-width:900px){.hero{grid-template-columns:1fr;}.modal{grid-template-columns:1fr}.product img{height:200px}}
  </style>
</head>
<body>

  <!-- Entrance overlay with 3D scene -->
  <div id="entrance">
    <canvas id="three-canvas"></canvas>
    <div class="enter-ui">
      <div class="enter-title">Welcome to G-Drive Apparel</div>
      <div class="enter-desc">Local-made hoodies, pants and sets · Modern light colors · Fast & visual</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="enter-btn" id="enter-btn">Enter Site</button>
        <button class="enter-btn" id="skip-btn" style="background:transparent;color:var(--muted);border:1px solid rgba(0,0,0,0.06)">Skip Animation</button>
      </div>
    </div>
  </div>

  <!-- Main site -->
  <div class="site" id="site" aria-hidden="true">
    <header>
      <div class="logo">G-Drive Apparel</div>
      <nav>
        <input class="search" id="search" placeholder="Search hoodies, pants, sets...">
        <button class="cart-btn" id="open-cart">Cart (<span id="cart-count">0</span>)</button>
      </nav>
    </header>

    <section class="hero">
      <div class="hero-card">
        <h1>Built for comfort. Inspired by the G-Class.</h1>
        <p>Explore our curated hoodies, pants and coordinated sets. Click any product to view sizes, price and 3D preview.</p>
      </div>
      <div class="hero-card center">
        <div style="text-align:center">
          <img src="https://images.unsplash.com/photo-1520975681911-8b9b2b2f2cc7?auto=format&fit=crop&w=800&q=60" alt="hero" style="width:100%;height:220px;object-fit:cover;border-radius:10px;margin-bottom:12px">
          <div style="font-weight:700">Fast delivery · Local production · Premium fabrics</div>
        </div>
      </div>
    </section>

    <section>
      <h2>Products</h2>
      <div class="grid" id="product-grid"></div>
    </section>

    <footer>© <span id="year"></span> G-Drive Apparel — Demo storefront (replace with Shopify integration)</footer>
  </div>

  <!-- Product modal -->
  <div class="modal-backdrop" id="product-modal">
    <div class="modal" role="dialog" aria-modal="true">
      <div>
        <div class="viewer-wrap" id="viewer-wrap">
          <!-- model-viewer inserted here -->
        </div>
      </div>
      <aside class="info">
        <h3 id="modal-title">Product</h3>
        <div class="meta" id="modal-desc">Description</div>
        <div class="price" id="modal-price">$0.00</div>

        <div class="size-select" id="size-container"></div>

        <button class="buy-btn" id="add-to-cart">Add to cart</button>
        <div style="margin-top:12px"><button class="cart-btn" id="close-modal">Close</button></div>
      </aside>
    </div>
  </div>

  <!-- Cart modal -->
  <div class="modal-backdrop" id="cart-modal">
    <div class="modal" style="max-width:760px;grid-template-columns:1fr">
      <div>
        <h3>Your cart</h3>
        <div class="cart-list" id="cart-list"></div>
      </div>
      <aside class="info">
        <div style="font-weight:700">Summary</div>
        <div style="margin-top:8px">Items: <span id="summary-count">0</span></div>
        <div style="margin-top:8px;font-size:20px;font-weight:700">Total: <span id="summary-total">$0.00</span></div>
        <div style="margin-top:16px"><button class="buy-btn" id="checkout-btn">Checkout</button></div>
        <div style="margin-top:12px"><button class="cart-btn" id="close-cart">Continue shopping</button></div>
      </aside>
    </div>
  </div>

<script>
// All DOM operations in DOMContentLoaded
document.addEventListener('DOMContentLoaded', function(){
  // Utility
  const centsToMoney = cents => '$' + (cents/100).toFixed(2)

  // Products — replace these with your real catalog or inject via Shopify Liquid
  const PRODUCTS = [
    {id:'hd-001',title:'G-Drive Hoodie — Sand',price:7900,images:['https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=900&q=60'],model:null,sizes:['S','M','L','XL'],desc:'Soft cotton blend hoodie. Modern fit.'},
    {id:'pt-001',title:'G-Drive Pants — Stone',price:6900,images:['https://images.unsplash.com/photo-1520975918432-0b4c0b7e71c4?auto=format&fit=crop&w=900&q=60'],model:null,sizes:['S','M','L','XL'],desc:'Comfort stretch joggers.'},
    {id:'set-001',title:'G-Drive Set — Light Grey',price:14900,images:['https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=900&q=60'],model:null,sizes:['S','M','L'],desc:'Matching hoodie + pants set.'},
    {id:'hd-002',title:'G-Drive Hoodie — Navy',price:8200,images:['https://images.unsplash.com/photo-1602810310324-7f8b6b5f6f42?auto=format&fit=crop&w=900&q=60'],model:null,sizes:['S','M','L','XL'],desc:'Deep navy hoodie.'},
    {id:'pt-002',title:'G-Drive Pants — Black',price:7200,images:['https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=900&q=60'],model:null,sizes:['M','L','XL'],desc:'Slim tapered pants.'}
  ]

  // Render products
  const grid = document.getElementById('product-grid')
  PRODUCTS.forEach(p=>{
    const el = document.createElement('article')
    el.className='product'
    el.innerHTML = `
      <img loading="lazy" src="${p.images[0]}" alt="${p.title}">
      <div class="title">${p.title}</div>
      <div class="meta">${p.desc}</div>
      <div class="price">${centsToMoney(p.price)}</div>
      <button class="buy-btn" data-id="${p.id}">Quick view</button>
    `
    grid.appendChild(el)
  })

  const yearEl = document.getElementById('year')
  if(yearEl) yearEl.textContent = new Date().getFullYear()

  // Cart logic
  const CART_KEY = 'gdrive_cart_v1'
  function loadCart(){try{return JSON.parse(localStorage.getItem(CART_KEY))||[]}catch(e){return[]}}
  function saveCart(c){localStorage.setItem(CART_KEY,JSON.stringify(c))}
  function cartCount(){return loadCart().reduce((s,i)=>s+i.qty,0)}
  function cartTotal(){return loadCart().reduce((s,i)=>s+i.qty*i.price,0)}
  function updateCartUI(){const el=document.getElementById('cart-count');if(el)el.textContent=cartCount();const sc=document.getElementById('summary-count');if(sc)sc.textContent=cartCount();const st=document.getElementById('summary-total');if(st)st.textContent=centsToMoney(cartTotal())}
  updateCartUI()

  // Product modal interactions
  let currentProduct = null
  const productModal = document.getElementById('product-modal')
  const cartModal = document.getElementById('cart-modal')
  const viewerWrap = document.getElementById('viewer-wrap')

  // open product modal
  grid.addEventListener('click', e=>{
    const btn = e.target.closest('button')
    if(!btn) return
    const id = btn.dataset.id
    openProduct(id)
  })

  function openProduct(id){
    const p = PRODUCTS.find(x=>x.id===id)
    if(!p) return
    currentProduct = p
    const titleEl = document.getElementById('modal-title')
    const descEl = document.getElementById('modal-desc')
    const priceEl = document.getElementById('modal-price')
    if(titleEl) titleEl.textContent = p.title
    if(descEl) descEl.textContent = p.desc
    if(priceEl) priceEl.textContent = centsToMoney(p.price)

    // model-viewer or fallback image (create elements instead of using innerHTML)
    if(viewerWrap){
      // clear previous contents
      viewerWrap.innerHTML = ''
      if(p.model){
        try{
          const mv = document.createElement('model-viewer')
          mv.setAttribute('src', p.model)
          mv.setAttribute('alt', p.title)
          mv.setAttribute('camera-controls', '')
          mv.setAttribute('auto-rotate', '')
          mv.setAttribute('ar', '')
          mv.setAttribute('ios-src', p.model)
          mv.setAttribute('interaction-prompt', 'auto')
          // styling to match previous dimensions
          mv.style.width = '100%'
          mv.style.height = '560px'
          viewerWrap.appendChild(mv)
        }catch(err){
          // fallback to image if model-viewer fails
          const img = document.createElement('img')
          img.src = p.images[0]
          img.alt = p.title
          img.style.width = '100%'
          img.style.height = '560px'
          img.style.objectFit = 'cover'
          viewerWrap.appendChild(img)
        }
      } else {
        const img = document.createElement('img')
        img.src = p.images[0]
        img.alt = p.title
        img.style.width = '100%'
        img.style.height = '560px'
        img.style.objectFit = 'cover'
        viewerWrap.appendChild(img)
      }
    }

    // sizes
    const sizeContainer = document.getElementById('size-container')
    if(sizeContainer){
      sizeContainer.innerHTML = ''
      p.sizes.forEach(s=>{
        const b = document.createElement('button')
        b.textContent = s
        b.dataset.size = s
        b.addEventListener('click', ()=>{
          Array.from(sizeContainer.children).forEach(x=>x.classList.remove('selected'))
          b.classList.add('selected')
        })
        sizeContainer.appendChild(b)
      })
    }

    if(productModal) productModal.style.display='flex'
  }

  const closeModalBtn = document.getElementById('close-modal')
  if(closeModalBtn) closeModalBtn.addEventListener('click', ()=>{ if(productModal) productModal.style.display='none' })
  if(productModal) productModal.addEventListener('click', e=>{ if(e.target===productModal) productModal.style.display='none' })

  // add to cart
  const addToCartBtn = document.getElementById('add-to-cart')
  if(addToCartBtn) addToCartBtn.addEventListener('click', ()=>{
    if(!currentProduct) return
    const sizeBtn = document.querySelector('#size-container button.selected')
    const selectedSize = sizeBtn ? sizeBtn.dataset.size : (currentProduct.sizes[0] || 'One Size')
    const cart = loadCart()
    const found = cart.find(i=>i.productId===currentProduct.id && i.size===selectedSize)
    if(found) found.qty +=1
    else cart.push({productId:currentProduct.id,title:currentProduct.title,price:currentProduct.price,qty:1,size:selectedSize,image:currentProduct.images[0]})
    saveCart(cart)
    updateCartUI()
    if(productModal) productModal.style.display='none'
  })

  // cart open
  const openCartBtn = document.getElementById('open-cart')
  if(openCartBtn) openCartBtn.addEventListener('click', ()=>{ renderCartList(); if(cartModal) cartModal.style.display='flex' })

  function renderCartList(){
    const list = document.getElementById('cart-list')
    const cart = loadCart()
    if(!list) return
    if(cart.length===0){ list.innerHTML = '<div style="padding:12px;color:var(--muted)">Your cart is empty.</div>'; return }
    list.innerHTML = ''
    cart.forEach((item,idx)=>{
      const row = document.createElement('div')
      row.className = 'cart-item'
      row.style.display='flex'
      row.style.alignItems='center'
      row.style.justifyContent='space-between'
      row.style.padding='8px 0'
      row.innerHTML = `
        <div style="display:flex;gap:12px;align-items:center">
          <img src="${item.image}" style="width:64px;height:64px;object-fit:cover;border-radius:8px">
          <div>
            <div style="font-weight:700">${item.title}</div>
            <div class="meta">Size: ${item.size} · ${centsToMoney(item.price)} × ${item.qty}</div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:700">${centsToMoney(item.price*item.qty)}</div>
          <div style="margin-top:8px"><button class="cart-btn" data-action="dec" data-idx="${idx}">-</button> <button class="cart-btn" data-action="inc" data-idx="${idx}">+</button></div>
        </div>
      `
      list.appendChild(row)
    })
  }

  // cart controls
  const cartListEl = document.getElementById('cart-list')
  if(cartListEl){
    cartListEl.addEventListener('click', e=>{
      const btn = e.target.closest('button')
      if(!btn) return
      const idx = Number(btn.dataset.idx)
      const action = btn.dataset.action
      const cart = loadCart()
      if(isNaN(idx)) return
      if(action==='inc') cart[idx].qty +=1
      if(action==='dec') cart[idx].qty = Math.max(0, cart[idx].qty -1)
      const clean = cart.filter(i=>i.qty>0)
      saveCart(clean)
      renderCartList()
      updateCartUI()
    })
  }

  const closeCartBtn = document.getElementById('close-cart')
  if(closeCartBtn) closeCartBtn.addEventListener('click', ()=>{ if(cartModal) cartModal.style.display='none' })
  if(cartModal) cartModal.addEventListener('click', e=>{ if(e.target===cartModal) cartModal.style.display='none' })

  const checkoutBtn = document.getElementById('checkout-btn')
  if(checkoutBtn) checkoutBtn.addEventListener('click', ()=>{
    const cart = loadCart()
    if(cart.length===0){ alert('Your cart is empty.'); return }
    // Build a safe multi-line summary using escaped newlines
    let summary = 'Order summary:

'
    cart.forEach(i=>{
      summary += `${i.title} (${i.size}) x${i.qty} — ${centsToMoney(i.price*i.qty)}
`
    })
    summary += `
Total: ${centsToMoney(cartTotal())}`
    alert(summary + '

Demo checkout. Integrate front-end with Shopify Storefront API or redirect to your Shopify checkout URL for production.')
    localStorage.removeItem(CART_KEY)
    renderCartList(); updateCartUI(); if(cartModal) cartModal.style.display='none'
  })

  // Search (simple client-side)
  const searchInput = document.getElementById('search')
  if(searchInput){
    searchInput.addEventListener('input', ()=>{
      const q = searchInput.value.trim().toLowerCase()
      Array.from(document.querySelectorAll('#product-grid .product')).forEach(card=>{
        const title = card.querySelector('.title').textContent.toLowerCase()
        const show = !q || title.includes(q)
        card.style.display = show ? '' : 'none'
      })
    })
  }

  // --------------------------------------------------
  // Entrance 3D scene using Three.js (simplified car placeholder)
  // --------------------------------------------------
  // This builds a stylized rectangle "car" with a separate "backDoor" mesh that we rotate to simulate opening.
  // Replace with GLTFLoader + named nodes if you have a detailed car GLB.

  const canvas = document.getElementById('three-canvas')
  const entranceEl = document.getElementById('entrance')
  const siteEl = document.getElementById('site')
  const enterBtn = document.getElementById('enter-btn')
  const skipBtn = document.getElementById('skip-btn')

  let renderer, scene, camera, carGroup, backDoor, animId
  function initThree(){
    // Defensive: if canvas is missing, bail
    if(!canvas) return
    renderer = new THREE.WebGLRenderer({canvas:canvas,antialias:true,alpha:true})
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
    renderer.setSize(window.innerWidth, window.innerHeight)
    scene = new THREE.Scene()
    scene.background = new THREE.Color(0x050507)

    camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 2000)
    camera.position.set(0, 2, 8)

    const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0)
    scene.add(hemi)
    const dir = new THREE.DirectionalLight(0xffffff, 0.8)
    dir.position.set(5,10,7)
    scene.add(dir)

    // Ground subtle
    const groundMat = new THREE.MeshStandardMaterial({color:0x0b0b0b,roughness:0.9,metalness:0})
    const ground = new THREE.Mesh(new THREE.PlaneGeometry(200,200), groundMat)
    ground.rotation.x = -Math.PI/2
    ground.position.y = -1.5
    scene.add(ground)

    // Car group
    carGroup = new THREE.Group()
    scene.add(carGroup)

    // Car body (stylized box)
    const bodyMat = new THREE.MeshStandardMaterial({color:0x1f2937,roughness:0.4,metalness:0.6})
    const body = new THREE.Mesh(new THREE.BoxGeometry(6,2.2,3.2), bodyMat)
    body.position.y = 0.4
    carGroup.add(body)

    // Back door: separate mesh to rotate
    const doorMat = new THREE.MeshStandardMaterial({color:0x111827,roughness:0.35,metalness:0.5})
    backDoor = new THREE.Mesh(new THREE.BoxGeometry(2.4,1.6,0.12), doorMat)
    backDoor.position.set( -2.9, 0.4, 0 )
    backDoor.rotation.y = 0
    // set pivot by moving geometry
    backDoor.geometry.translate(1.2,0,0) // pivot on right edge
    carGroup.add(backDoor)

    // subtle box that represents the "entry box" inside back door
    const boxMat = new THREE.MeshStandardMaterial({color:0xf8fafc,emissive:0x1e293b,emissiveIntensity:0.02})
    const entryBox = new THREE.Mesh(new THREE.BoxGeometry(1.6,1.6,1.6), boxMat)
    entryBox.position.set(-3.6,0.4,0)
    carGroup.add(entryBox)

    // Camera target point
    camera.lookAt(new THREE.Vector3(-3.4,0.4,0))

    window.addEventListener('resize', onResize)

    animate() // start animation loop so background is lively while entrance visible
  }

  function onResize(){
    const w = window.innerWidth; const h = window.innerHeight
    if(camera){ camera.aspect = w/h; camera.updateProjectionMatrix() }
    if(renderer) renderer.setSize(w,h)
  }

  let startTime = null
  let played = false
  function animate(t){
    animId = requestAnimationFrame(animate)
    if(!startTime) startTime = t
    const elapsed = (t - startTime)/1000
    // slight rotation for the car
    if(carGroup) carGroup.rotation.y = Math.sin(elapsed*0.3)*0.08
    if(renderer && camera) renderer.render(scene, camera)
  }

  // Play entrance animation: open back door and move camera through the door
  function playEntranceAnimation(onComplete){
    if(played){ if(onComplete) onComplete(); return }
    played = true
    const duration = 2200
    const start = performance.now()

    function tick(now){
      const p = Math.min(1, (now - start) / duration)
      // door rotates open: 0 -> -1.5 radians
      if(backDoor) backDoor.rotation.y = -p * 1.5
      // camera dolly forward and slightly down into the box
      if(camera){
        const camStart = new THREE.Vector3(0,2,8)
        const camEnd = new THREE.Vector3(-3.55,0.7,0)
        camera.position.lerpVectors(camStart, camEnd, easeInOutCubic(p))
        camera.lookAt(new THREE.Vector3(-3.4,0.4,0))
      }
      if(renderer && camera) renderer.render(scene, camera)
      if(p < 1) requestAnimationFrame(tick)
      else {
        // short delay then reveal site
        setTimeout(()=>{ if(onComplete) onComplete() }, 350)
      }
    }
    requestAnimationFrame(tick)
  }

  function easeInOutCubic(t){ return t<0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2 }

  // Hook enter buttons
  if(enterBtn) enterBtn.addEventListener('click', ()=>{
    // play animation then show site
    playEntranceAnimation(()=>{
      if(entranceEl) entranceEl.style.display='none'
      if(siteEl) siteEl.setAttribute('aria-hidden','false')
    })
  })

  if(skipBtn) skipBtn.addEventListener('click', ()=>{
    // stop animation and show site immediately
    cancelAnimationFrame(animId)
    if(renderer) renderer.dispose()
    if(entranceEl) entranceEl.style.display='none'
    if(siteEl) siteEl.setAttribute('aria-hidden','false')
  })

  // initialize three later to ensure scripts loaded
  // check that THREE exists (deferred script may not yet be parsed); poll for it
  function waitForThreeAndInit(){
    if(window.THREE){ initThree(); }
    else setTimeout(waitForThreeAndInit, 80)
  }
  waitForThreeAndInit()

  // Hide the entrance if user presses Escape
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ if(entranceEl) entranceEl.style.display='none'; if(siteEl) siteEl.setAttribute('aria-hidden','false') } })

  // Safety: ensure modals close clicks are attached
  const pm = document.getElementById('product-modal')
  if(pm) pm.addEventListener('click', e=>{ if(e.target===pm) pm.style.display='none' })

}) // DOMContentLoaded
</script>
</body>
</html>
